# 并行模式指南

## 核心规则

> ⚠️ **必须在单个 message 中发起所有并行任务**
>
> 不能发送一个 message 调用 Task，等待结果，再发送另一个 message 调用另一个 Task。必须在同一个 response 中同时调用多个 Task 工具。

---

## 阶段 2: 并行探索

### 何时使用

- ✅ 需求涉及多个架构层次（数据层、服务层、API 层）
- ✅ 需求涉及多个模块或子系统
- ✅ 探索任务可以清晰分解为独立的子任务

### 探索策略

**策略 1：按架构层次分解**（推荐）
- Agent 1：数据层探索（实体、数据库、迁移）
- Agent 2：服务层探索（业务逻辑、验证、错误处理）
- Agent 3：API 层探索（控制器、路由、请求/响应）

**策略 2：按功能模块分解**
- Agent 1：核心功能模块
- Agent 2：关联功能模块
- Agent 3：通用工具和模式

### 并行数量建议

- 简单需求：1 个 agent（使用基础探索模式）
- 中等需求：2-3 个 agent
- 复杂需求：3-5 个 agent
- ⚠️ 不建议超过 5 个并行任务

### 结果汇总

1. 等待所有并行 agent 完成
2. 整合各个 agent 的发现
3. 识别重复信息并去重
4. 组织成结构化的探索报告

---

## 阶段 8: 并行深度审查

### 何时使用

- ✅ 复杂需求，修改文件多（4+ 个文件）
- ✅ 涉及多个架构层次或模块
- ✅ 需要深度审查，确保高质量

### 5 个审查维度

**Reviewer 1**：功能正确性
- 检查逻辑错误和潜在 Bug
- 验证边缘情况处理

**Reviewer 2**：代码风格和质量
- 检查命名是否清晰一致
- 评估代码可读性

**Reviewer 3**：简洁性/DRY/优雅性
- 识别重复代码（DRY 原则）
- 评估抽象是否恰当

**Reviewer 4**：项目规范遵循
- 验证是否符合 CLAUDE.md 编码规范
- 检查文件结构是否符合项目约定

**Reviewer 5**：项目约定和抽象
- 检查是否使用了项目已有工具和模式
- 验证是否遵循项目架构模式

### 结果汇总

1. 等待所有并行审查完成
2. 整合所有审查结果
3. 按严重性分类问题（高、中、低）
4. 组织成结构化的审查报告
