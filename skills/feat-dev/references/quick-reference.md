# 快速参考

本文档提供阶段标记模板、检查清单和常用信息。

---

## 阶段标记模板

### 每个阶段开始
```markdown
---
## 🚀 当前阶段：[X] - [阶段名称]
---
```

### 每个阶段结束
```markdown
---
✅ 阶段 [X] 完成
📍 下一阶段：[X+1] - [阶段名称]
---
```

### 用户输入后继续
```markdown
---
📥 已收到用户输入
🔄 继续阶段 [X] - [阶段名称]
---
```

---

## 强制检查点

- **阶段 3 → 4**：使用 AskUserQuestion 后必须等待用户回应
- **阶段 4 → 5**：**必须**等待用户确认架构方案
- **阶段 5 → 6**：实施完成才能审查

### 禁止跳跃
- ❌ 不能从阶段 3 直接到阶段 5
- ❌ 不能在未确认架构时开始实施
- ❌ 收到用户输入后不能跳出 skill

---

## 常见实施顺序

### 通用后端功能
1. 数据层：实体定义、数据库模式
2. 数据访问层：Repository/DAO
3. 服务层：业务逻辑、事务管理
4. 传输对象：DTO/请求响应结构
5. API 层：控制器/路由处理
6. 验证：输入验证、错误处理
7. 测试：单元测试、集成测试

### 前端功能
1. 数据模型：类型定义、接口
2. API 客户端：HTTP 请求封装
3. 状态管理：Store/Context
4. UI 组件：可复用组件
5. 页面组件：完整页面
6. 路由：路由配置
7. 测试：组件测试、E2E 测试

### 全栈功能
1. 数据库设计
2. 后端 API 实现
3. API 文档和测试
4. 前端数据模型
5. 前端 UI 实现
6. 集成测试
7. 端到端测试

---

## 安全检查清单

### 输入验证
- [ ] 所有用户输入都经过验证
- [ ] 验证数据类型、长度、格式
- [ ] 验证文件上传类型和大小
- [ ] 验证 ID 和数值范围

### 认证和授权
- [ ] 需要认证的端点添加了认证中间件
- [ ] 正确验证了用户权限
- [ ] 用户只能访问自己的资源

### 注入防护
- [ ] 使用参数化查询防止 SQL 注入
- [ ] 验证和转义用户输入防止 XSS
- [ ] 防止命令注入

### 敏感信息
- [ ] 不在日志中记录密码、token
- [ ] 不在响应中返回敏感字段
- [ ] 使用环境变量存储敏感配置
- [ ] 对敏感数据加密存储

### 错误处理
- [ ] 不在错误消息中暴露内部实现细节
- [ ] 统一的错误响应格式
- [ ] 使用正确的 HTTP 状态码

---

## 性能优化检查

### 数据库
- [ ] 为常用查询字段添加索引
- [ ] 避免 N+1 查询问题
- [ ] 使用预加载/联合查询
- [ ] 使用分页限制返回数据量
- [ ] 只查询需要的字段

### API
- [ ] 实施请求速率限制
- [ ] 使用缓存减少重复计算
- [ ] 压缩响应数据
- [ ] 使用 CDN 分发静态资源

### 前端
- [ ] 代码分割和懒加载
- [ ] 图片优化和懒加载
- [ ] 使用虚拟滚动处理大列表
- [ ] 防抖和节流用户输入

---

## 常用命令参考

### 测试命令
```bash
# 运行所有测试
npm test / go test ./... / pytest

# 运行特定测试
npm test -- <file> / go test -run <test> / pytest <file>

# 测试覆盖率
npm run coverage / go test -cover / pytest --cov
```

---

## 降级决策流程

```
尝试 MCP 工具
  ↓
成功？
  ├─ 是 → 继续使用
  └─ 否 → 立即切换降级方案 → 继续工作流（不中断）
```

**重要**：永远不要因为 MCP 工具不可用而中断工作流。
